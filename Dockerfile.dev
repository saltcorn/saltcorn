FROM node:14

RUN npm install -g lerna

WORKDIR /opt/saltcorn

COPY . /opt/saltcorn

RUN lerna bootstrap

ENV PATH "$PATH:/opt/saltcorn/packages/saltcorn-cli/bin/saltcorn"
ENV SALTCORN_MULTI_TENANT "true"
ENV SQLITE_FILEPATH "/tmp/testdb.sqlite"

RUN echo '127.0.0.1 example.com sub.example.com sub1.example.com sub2.example.com sub3.example.com sub4.example.com sub5.example.com' | tee -a /etc/hosts

ENTRYPOINT ["/opt/saltcorn/packages/saltcorn-cli/bin/saltcorn"]
